<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>chrome:///newtab</title>
  <meta http-equiv="Permissions-Policy" content="clipboard-read/write=*, geolocation=(self)">
  <style>
    body, h2, input, .result-box, button { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family: Arial, sans-serif;
      background: #111;
      color: #ccc; /* Gray text for the body */
      padding: 20px;
      overflow: hidden;
      height: 100vh; /* Make sure body takes up full screen height */
      cursor: pointer; /* Indicate that clicking anywhere opens the calculator */
    }

    /* Floating Calculator Container */
    .container {
      max-width: 420px;
      max-height: 80vh; /* Limit container height to 80% of the screen */
      background: rgba(34,34,34,0.85);
      border-radius:5px;
      position:absolute;
      top:20px;
      left:20px;
      resize:both;
      overflow:auto;
      border:1px solid rgba(255,255,255,0.3);
      opacity:1;
      transition: all 0.3s ease;
      display: none; /* Initially hidden */
    }

    /* Header without close button */
    h2 {
      font-weight:300;
      font-size:20px;
      cursor:move;
      padding:10px;
      background-color: rgba(51,51,51,0.8);
      border-radius:5px 5px 0 0;
      color:#ccc; /* Gray text for the header */
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: relative;
    }

    /* Input fields and result box */
    input, .result-box {
      width:100%;
      padding:8px;
      margin:6px 0;
      border:1px solid #555;
      border-radius:4px;
      background:#000;
      color:#ccc; /* Gray text for inputs and result box */
      font-size:14px;
      opacity:1;
    }

    input::placeholder { 
      color:#888; /* Placeholder text in light gray */
    }

    .result-box {
      background:#000;
      border-radius:5px;
      font-size:14px;
      white-space:pre-line;
      user-select:text;
      cursor:pointer;
      transition:color 0.18s ease;
      opacity:1;
      color: #ccc; /* Gray text color */
    }

    .result-box:hover { 
      background:#444; 
    }

    /* Transparency Slider */
    .slider-container {
      margin-top:10px;
      text-align:center;
      padding:10px 0;
    }

    .slider {
      width:100%;
      height:6px;
      background:#444;
      border-radius:3px;
      cursor:pointer;
      -webkit-appearance:none;
      appearance:none;
      outline:none;
    }

    .slider::-webkit-slider-thumb {
      width:14px;
      height:14px;
      background:#fff;
      border-radius:50%;
      border:2px solid #888;
      -webkit-appearance:none;
      appearance:none;
    }

    .slider::-moz-range-thumb {
      width:14px;
      height:14px;
      background:#fff;
      border-radius:50%;
      border:2px solid #888;
    }

    /* Timer Display */
    .timer {
      font-size: 16px;
      color: #ccc; /* Gray timer text */
      margin-top: 10px;
    }

  </style>
</head>
<body>

<div class="container" id="container">
  <h2 id="dragHandle">
    JOB COUNT
  </h2>

  <input type="number" id="break1" placeholder="1st Break" oninput="saveAndCalculate()">
  <input type="number" id="lunch" placeholder="Lunch" oninput="saveAndCalculate()">
  <input type="number" id="break2" placeholder="2nd Break" oninput="saveAndCalculate()">
  <input type="number" id="eos" placeholder="EOS" oninput="saveAndCalculate()">
  <input type="text" id="station" placeholder="Station#" oninput="saveAndCalculate()">

  <div class="result-box" id="resultBox" onclick="copyToClipboard()">Click to Copy</div>

  <div class="slider-container">
    <input type="range" id="transparencySlider" class="slider" min="0" max="100" value="65" oninput="updateTransparency()">
  </div>

  <!-- Timer Display -->
  <div id="timerDisplay" class="timer">Timer: 0s</div>
</div>

<script>
// Fields
const fields = ['break1','lunch','break2','eos','station'];
const container = document.getElementById('container');
const resultBox = document.getElementById('resultBox');
const transparencySlider = document.getElementById('transparencySlider');
const timerDisplay = document.getElementById('timerDisplay');

let closeTimer; // Timer for closing calculator
let startTime; // Timer start time
let timerInterval; // Timer interval to update every second

// Set initial transparency based on slider value
container.style.opacity = transparencySlider.value / 100;

// Drag
let isDragging=false, offsetX=0, offsetY=0;
document.getElementById('dragHandle').addEventListener('mousedown', e=> {
  isDragging=true;
  offsetX=e.clientX-container.offsetLeft;
  offsetY=e.clientY-container.offsetTop;
  document.addEventListener('mousemove', onDrag);
  document.addEventListener('mouseup', ()=> {
    isDragging=false;
    document.removeEventListener('mousemove', onDrag);
  });
});

function onDrag(e) { 
  if(isDragging){
    const maxX = window.innerWidth - container.offsetWidth - 20;
    const maxY = window.innerHeight - container.offsetHeight - 20;
    let newLeft = e.clientX - offsetX;
    let newTop = e.clientY - offsetY;

    if (newLeft < 0) newLeft = 0;
    if (newLeft > maxX) newLeft = maxX;
    if (newTop < 0) newTop = 0;
    if (newTop > maxY) newTop = maxY;

    container.style.left = `${newLeft}px`;
    container.style.top = `${newTop}px`;
  }
}

// Toggle open/close on body click
document.body.addEventListener('click', function(event) {
  if (container.style.display === 'none') {
    showCalculator(); // Open the calculator
  } else if (!container.contains(event.target)) {
    closeCalculator(); // Close the calculator if clicking outside
  }
});

// Show calculator function
function showCalculator() {
  container.style.display = 'block';
  resetCloseTimer(); // Start the timer when the calculator is shown
  startTime = Date.now(); // Capture the start time
  startTimer(); // Start the timer interval
}

// Close calculator function
function closeCalculator() {
  container.style.display = 'none';
  clearInterval(timerInterval); // Stop the timer when closing the calculator
}

// Start Timer
function startTimer() {
  timerInterval = setInterval(() => {
    const elapsedTime = Math.floor((Date.now() - startTime) / 1000); // Time in seconds
    timerDisplay.textContent = `Timer: ${elapsedTime}s`;
  }, 1000); // Update every second
}

// Load saved
window.addEventListener('DOMContentLoaded', () => {
  fields.forEach(f => {
    const v = localStorage.getItem(f);
    if (v) document.getElementById(f).value = v;
  });
  calculate();
});

// Save & Calculate
function saveAndCalculate() {
  const anyFilled = fields.some(id => document.getElementById(id).value.trim());
  fields.forEach(id => {
    const val = document.getElementById(id).value;
    if (anyFilled) localStorage.setItem(id, val);
    else localStorage.removeItem(id);
  });
  calculate();
}

// Calculate
function calculate() {
  const vals = fields.map(id => id === "station" ? document.getElementById(id).value : parseInt(document.getElementById(id).value) || 0);
  const [b1, l, b2, e, station] = vals;
  const res1 = b1 ? b1 : "", res2 = l ? (l - b1) : "", res3 = b2 ? (b2 - l) : "", res4 = e ? (e - b2) : "";
  const lines = [];
  if (e > 0) {
    const today = new Date();
    const date = `${String(today.getMonth() + 1).padStart(2, '0')}/${String(today.getDate()).padStart(2, '0')}/${today.getFullYear()}`;
    lines.push(`EOD Report ${date}`, "");
  }
  lines.push("Jobcount");
  if (res1) lines.push(`1st Break: ${res1}`);
  if (res2) lines.push(`Lunch: ${res2}`);
  if (res3) lines.push(`2nd Break: ${res3}`);
  if (res4) lines.push(`EOS: ${res4}`);
  if (e > 0) {
    lines.push(`Total: ${e}`);
    if (station) lines.push("", `Station#: ${station}`);
    lines.push("ğ˜–ğ˜¯ ğ˜µğ˜ªğ˜®ğ˜¦ ğ˜µğ˜¢ğ˜¨ğ˜¨ğ˜ªğ˜¯ğ˜¨, ğ˜•ğ˜– ğ˜–ğ˜‰ ğ˜¢ğ˜¯ğ˜¥ ğ˜•ğ˜– ğ˜°ğ˜·ğ˜¦ğ˜³ ğ˜­ğ˜¶ğ˜¯ğ˜¤ğ˜©");
    lines.push("ğ˜Šğ˜°ğ˜®ğ˜±ğ˜­ğ˜¦ğ˜µğ˜¦ ğ˜ˆğ˜´ğ˜´ğ˜¦ğ˜µğ˜´: ğ˜•ğ˜° ğ˜‹ğ˜¢ğ˜®ğ˜¢ğ˜¨ğ˜¦ğ˜´ & ğ˜ğ˜ªğ˜µğ˜©ğ˜°ğ˜¶ğ˜µ ğ˜—ğ˜³ğ˜ªğ˜·ğ˜¢ğ˜¤ğ˜º ğ˜šğ˜¤ğ˜³ğ˜¦ğ˜¦ğ˜¯");
  }
  resultBox.textContent = lines.join("\n");
}

// Transparency
function updateTransparency() {
  container.style.opacity = transparencySlider.value / 100;
}

// Copy & Auto-hide
function copyToClipboard() {
  const text = resultBox.textContent;
  const ta = document.createElement('textarea');
  ta.value = text;
  document.body.appendChild(ta);
  ta.select();
  document.execCommand('copy');
  document.body.removeChild(ta);
  alert("Copied to clipboard!");
  closeCalculator(); // Close the calculator after copying
}

// Reset and start close timer
function resetCloseTimer() {
  clearTimeout(closeTimer); // Clear any existing timer
  closeTimer = setTimeout(closeCalculator, 10000); // Close after 10 seconds
}
</script>

</body>
</html>
