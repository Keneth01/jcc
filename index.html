<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>chrome:///newtab</title>
  <meta http-equiv="Permissions-Policy" content="clipboard-read/write=*, geolocation=(self)">
  <style>
    body, h2, input, .result-box, button { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family: Arial, sans-serif;
      background: #111;
      color: #fff;
      padding: 20px;
      overflow: hidden;
    }

    /* Floating Calculator Container */
    .container {
      max-width: 420px;
      max-height: 80vh; /* Limit container height to 80% of the screen */
      background: rgba(34,34,34,0.85);
      border-radius:5px;
      position:absolute;
      top:20px;
      left:20px;
      resize:both;
      overflow:auto;
      border:1px solid rgba(255,255,255,0.3);
      opacity:1;
      transition: all 0.3s ease;
      display: none; /* Initially hidden */
    }

    /* Header with buttons */
    h2 {
      font-weight:300;
      font-size:20px;
      cursor:move;
      padding:10px;
      background-color: rgba(51,51,51,0.8);
      border-radius:5px 5px 0 0;
      color:#fff;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: relative;
    }

    .header-buttons {
      display: flex;
      gap: 10px;
    }

    .header-buttons button {
      background-color: transparent;
      color: #fff;
      border: none;
      font-size: 18px;
      cursor: pointer;
    }

    .header-buttons button:hover {
      color: #4285f4;
    }

    /* Input fields and result box */
    input, .result-box {
      width:100%;
      padding:8px;
      margin:6px 0;
      border:1px solid #555;
      border-radius:4px;
      background:#000;
      color:#fff;
      font-size:14px;
      opacity:1;
    }

    input::placeholder { color:#888; }
    .result-box {
      background:#000;
      border-radius:5px;
      font-size:14px;
      white-space:pre-line;
      user-select:text;
      cursor:pointer;
      transition:color 0.18s ease;
      opacity:1;
    }
    .result-box:hover { background:#444; }

    /* Transparency Slider */
    .slider-container {
      margin-top:10px;
      text-align:center;
      padding:10px 0;
    }

    .slider {
      width:100%;
      height:6px;
      background:#444;
      border-radius:3px;
      cursor:pointer;
      -webkit-appearance:none;
      appearance:none;
      outline:none;
    }

    .slider::-webkit-slider-thumb {
      width:14px;
      height:14px;
      background:#fff;
      border-radius:50%;
      border:2px solid #888;
      -webkit-appearance:none;
      appearance:none;
    }

    .slider::-moz-range-thumb {
      width:14px;
      height:14px;
      background:#fff;
      border-radius:50%;
      border:2px solid #888;
    }

    /* Minimalist Dark Gray Button */
    #showButton {
      position:fixed;
      top:20px;
      left:20px;
      padding:10px 20px;
      font-size:14px;
      border:none;
      border-radius:5px;
      background:#333; /* Dark gray */
      color:#fff;
      cursor:pointer;
      z-index:9999;
      display: block; /* Initially visible */
      font-weight: bold;
      opacity: 0.8;
      transition: opacity 0.3s ease;
    }

    #showButton:hover {
      opacity: 1;
    }
  </style>
</head>
<body>

<div class="container" id="container">
  <h2 id="dragHandle">
    JOB COUNT
    <div class="header-buttons">
      <button id="closeButton" onclick="closeCalculator()">❌</button>
    </div>
  </h2>

  <input type="number" id="break1" placeholder="1st Break" oninput="saveAndCalculate()">
  <input type="number" id="lunch" placeholder="Lunch" oninput="saveAndCalculate()">
  <input type="number" id="break2" placeholder="2nd Break" oninput="saveAndCalculate()">
  <input type="number" id="eos" placeholder="EOS" oninput="saveAndCalculate()">
  <input type="text" id="station" placeholder="Station#" oninput="saveAndCalculate()">

  <div class="result-box" id="resultBox" onclick="copyToClipboard()">Click to Copy</div>

  <div class="slider-container">
    <input type="range" id="transparencySlider" class="slider" min="0" max="100" value="85" oninput="updateTransparency()">
  </div>
</div>

<button id="showButton" onclick="showCalculator()">Open Calculator</button>

<script>
// Fields
const fields = ['break1','lunch','break2','eos','station'];
const container = document.getElementById('container');
const resultBox = document.getElementById('resultBox');
const transparencySlider = document.getElementById('transparencySlider');
const showButton = document.getElementById('showButton');

let closeTimer; // Timer for closing calculator

// Drag
let isDragging=false, offsetX=0, offsetY=0;
document.getElementById('dragHandle').addEventListener('mousedown', e=> {
  isDragging=true;
  offsetX=e.clientX-container.offsetLeft;
  offsetY=e.clientY-container.offsetTop;
  document.addEventListener('mousemove', onDrag);
  document.addEventListener('mouseup', ()=> {
    isDragging=false;
    document.removeEventListener('mousemove', onDrag);
  });
});

function onDrag(e) { 
  if(isDragging){
    const maxX = window.innerWidth - container.offsetWidth - 20;
    const maxY = window.innerHeight - container.offsetHeight - 20;
    let newLeft = e.clientX - offsetX;
    let newTop = e.clientY - offsetY;

    if (newLeft < 0) newLeft = 0;
    if (newLeft > maxX) newLeft = maxX;
    if (newTop < 0) newTop = 0;
    if (newTop > maxY) newTop = maxY;

    container.style.left = `${newLeft}px`;
    container.style.top = `${newTop}px`;
  }
}

// Close / Show
function closeCalculator() {
  container.style.display='none';
  showButton.style.display = 'block';
  clearTimeout(closeTimer); // Clear the previous timer when closing manually
}

function showCalculator() {
  container.style.display='block';
  showButton.style.display = 'none';
  resetCloseTimer(); // Start the timer when the calculator is shown
}

// Load saved
window.addEventListener('DOMContentLoaded', ()=> {
  fields.forEach(f=> {
    const v=localStorage.getItem(f);
    if(v) document.getElementById(f).value=v;
  });
  calculate();
});

// Save & Calculate
function saveAndCalculate() {
  const anyFilled = fields.some(id => document.getElementById(id).value.trim());
  fields.forEach(id => {
    const val = document.getElementById(id).value;
    if (anyFilled) localStorage.setItem(id, val);
    else localStorage.removeItem(id);
  });
  calculate();
}

// Calculate
function calculate() {
  const vals = fields.map(id => id === "station" ? document.getElementById(id).value : parseInt(document.getElementById(id).value) || 0);
  const [b1, l, b2, e, station] = vals;
  const res1 = b1 ? b1 : "", res2 = l ? (l - b1) : "", res3 = b2 ? (b2 - l) : "", res4 = e ? (e - b2) : "";
  const lines = [];
  if (e > 0) {
    const today = new Date();
    const date = `${String(today.getMonth() + 1).padStart(2, '0')}/${String(today.getDate()).padStart(2, '0')}/${today.getFullYear()}`;
    lines.push(`EOD Report ${date}`, "");
  }
  lines.push("Jobcount");
  if (res1) lines.push(`1st Break: ${res1}`);
  if (res2) lines.push(`Lunch: ${res2}`);
  if (res3) lines.push(`2nd Break: ${res3}`);
  if (res4) lines.push(`EOS: ${res4}`);
  if (e > 0) {
    lines.push(`Total: ${e}`);
    if (station) lines.push("", `Station#: ${station}`);
    lines.push("𝘖𝘯 𝘵𝘪𝘮𝘦 𝘵𝘢𝘨𝘨𝘪𝘯𝘨, 𝘕𝘖 𝘖𝘉 𝘢𝘯𝘥 𝘕𝘖 𝘰𝘷𝘦𝘳 𝘭𝘂𝘯𝘤𝘩");
    lines.push("𝘊𝘰𝘮𝘱𝘭𝘦𝘵𝘦 𝘈𝘴𝘴𝘦𝘵𝘴: 𝘕𝘰 𝘋𝘢𝘮𝘢𝘨𝘦𝘴 & 𝘞𝘪𝘵𝘩𝘰𝘶𝘵 𝘗𝘳𝘪𝘷𝘢𝘤𝘺 𝘚𝘤𝘳𝘦𝘦𝘯");
  }
  resultBox.textContent = lines.join("\n");
}

// Transparency
function updateTransparency() {
  container.style.opacity = transparencySlider.value / 100;
}

// Copy & Auto-hide
function copyToClipboard() {
  const text = resultBox.textContent;
  const ta = document.createElement('textarea');
  ta.value = text;
  document.body.appendChild(ta);
  ta.select();
  document.execCommand('copy');
  document.body.removeChild(ta);
  alert("Copied to clipboard!");
  closeCalculator(); // Close the calculator after copying
}

// Reset and start close timer
function resetCloseTimer() {
  clearTimeout(closeTimer); // Clear any existing timer
  closeTimer = setTimeout(closeCalculator, 10000); // Close after 10 seconds
}
</script>

</body>
</html>
